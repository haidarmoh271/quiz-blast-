<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ALPHA Quiz â€” Ø§Ù†Ø¶Ù…</title>
<script src="/socket.io/socket.io.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&family=Oswald:wght@700&display=swap');
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:'Tajawal',sans-serif;
  min-height:100vh;
  background:#111;
  color:#fff;display:flex;flex-direction:column;
}
/* scanline */
body::after{
  content:'';position:fixed;
  top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,#fff,transparent);
  animation:scan 4s linear infinite;pointer-events:none;z-index:999;
}
@keyframes scan{0%{top:-2px;}100%{top:100vh;}}

.topbar{
  background:#1a1a1a;
  border-bottom:1px solid #222;
  padding:0.8rem 1.5rem;
  display:flex;align-items:center;gap:1rem;
  position:relative;
}
.topbar::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:#fff;}
.topbar a{color:#888;text-decoration:none;font-size:1.2rem;}
.topbar-brand{
  font-family:'Oswald',sans-serif;
  font-size:1.1rem;letter-spacing:0.2em;color:#fff;
}
.topbar-brand span{color:#fff;}

.main{flex:1;display:flex;align-items:center;justify-content:center;padding:2rem;}

.card{
  background:#1a1a1a;
  border:1px solid #2a2a2a;
  border-radius:4px;padding:2rem;
  width:100%;max-width:400px;text-align:center;
  position:relative;
}
.card::before{content:'';position:absolute;top:0;right:0;width:3px;height:100%;background:#fff;}
.card::after{content:'';position:absolute;bottom:0;left:0;width:3px;height:100%;background:#333;}

.card-title{
  font-family:'Oswald',sans-serif;
  font-size:1.4rem;letter-spacing:0.2em;
  margin-bottom:1.5rem;color:#fff;
}
.card-title span{color:#fff;}

input{
  width:100%;padding:1rem;
  border-radius:2px;
  border:1px solid #333;
  background:#111;color:#fff;
  font-size:1.2rem;font-family:'Tajawal',sans-serif;
  outline:none;margin-bottom:1rem;text-align:center;
  letter-spacing:0.1em;
  transition:border-color 0.2s;
}
input::placeholder{color:#444;}
input:focus{border-color:#fff;box-shadow:0 0 10px rgba(255,255,255,0.15);}

.btn{
  width:100%;padding:1rem;border:none;border-radius:2px;
  font-size:1rem;letter-spacing:0.2em;
  font-family:'Tajawal',sans-serif;font-weight:700;
  cursor:pointer;transition:all 0.15s;text-transform:uppercase;
}
.btn-join{
  background:#fff;color:#fff;
  box-shadow:none;
}
.btn-join:hover{background:#ccc;box-shadow:none;}

/* Waiting */
#waiting{display:none;text-align:center;}
.avatar{font-size:3rem;animation:pulse-icon 2s infinite;}
@keyframes pulse-icon{0%,100%{transform:scale(1);}50%{transform:scale(1.1);}}
.player-name-big{
  font-family:'Oswald',sans-serif;
  font-size:2rem;letter-spacing:0.2em;margin:0.5rem 0;color:#fff;
}
.waiting-text{color:#888;font-size:0.9rem;letter-spacing:0.2em;text-transform:uppercase;}
.pulse-ring{
  width:60px;height:60px;border-radius:50%;
  border:2px solid #fff;margin:2rem auto;
  animation:ring 1.5s infinite;
}
@keyframes ring{0%{transform:scale(1);opacity:1;}100%{transform:scale(2.5);opacity:0;}}

/* Question */
#question{display:none;}
.q-header{
  background:#1a1a1a;border-bottom:1px solid #222;
  padding:0.8rem 1.5rem;text-align:center;
  position:sticky;top:0;z-index:10;
}
.q-counter-text{font-size:0.8rem;letter-spacing:0.2em;color:#888;text-transform:uppercase;}
.timer-bar{height:4px;background:#1a1a1a;margin-top:0.5rem;}
.timer-fill{height:100%;background:#fff;transition:width 1s linear;}

.q-text-player{
  padding:1.5rem 2rem;font-size:1.3rem;font-weight:700;
  text-align:center;background:#1a1a1a;border-bottom:1px solid #1a1a1a;
  min-height:80px;display:flex;align-items:center;justify-content:center;
}
.q-image{width:100%;max-height:200px;object-fit:cover;}

.answer-btns{
  display:grid;grid-template-columns:1fr 1fr;
  gap:2px;background:#111;
  height:calc(100vh - 160px);
}
.ans-btn{
  border:none;cursor:pointer;
  font-size:1.1rem;font-family:'Tajawal',sans-serif;font-weight:700;
  color:#fff;display:flex;align-items:center;justify-content:center;
  gap:0.5rem;transition:filter 0.1s;padding:1rem;
  text-align:center;
}
.ans-btn:active{filter:brightness(0.7);}
.ans-btn.selected{filter:brightness(0.5);cursor:default;}
.ans-btn.disabled{filter:brightness(0.3);cursor:default;}

/* Answer Result */
#answerResult{
  display:none;position:fixed;inset:0;
  background:#111;
  align-items:center;justify-content:center;
  flex-direction:column;text-align:center;padding:2rem;z-index:100;
}
.result-icon{font-size:5rem;animation:pop 0.4s cubic-bezier(0.34,1.56,0.64,1);}
@keyframes pop{from{transform:scale(0);}to{transform:scale(1);}}
.result-text{
  font-family:'Oswald',sans-serif;
  font-size:2rem;letter-spacing:0.2em;margin:1rem 0;
}
.result-points{
  font-size:1.2rem;color:#fff;font-weight:700;letter-spacing:0.1em;
}

/* Leaderboard */
#lbUpdate{
  display:none;position:fixed;inset:0;
  background:#111;
  align-items:flex-start;justify-content:center;
  padding:2rem;overflow-y:auto;z-index:100;flex-direction:column;
}
.lb-title{
  font-family:'Oswald',sans-serif;
  font-size:1.3rem;letter-spacing:0.3em;
  text-align:center;margin-bottom:1.5rem;
  color:#fff;width:100%;
}
.lb-row{
  display:flex;align-items:center;gap:1rem;
  background:#1a1a1a;border:1px solid #2a2a2a;
  border-right:3px solid #fff;
  padding:0.8rem 1.2rem;margin-bottom:0.5rem;
  max-width:400px;width:100%;
}
.lb-rank{font-size:1.1rem;width:30px;font-family:'Oswald',sans-serif;}
.lb-name{flex:1;font-weight:700;}
.lb-score{color:#fff;font-weight:900;font-family:'Oswald',sans-serif;}

/* Final */
#playerFinal{
  display:none;text-align:center;padding:2rem;
}
.final-rank-big{font-size:5rem;}
.final-msg{
  font-family:'Oswald',sans-serif;
  font-size:1.5rem;letter-spacing:0.2em;margin:0.5rem 0;
}

/* Toast */
.toast{
  position:fixed;top:1rem;left:50%;transform:translateX(-50%);
  background:#fff;color:#fff;padding:0.8rem 1.5rem;
  border-radius:2px;font-size:0.9rem;letter-spacing:0.1em;
  z-index:9999;animation:fadeInOut 3s forwards;
}
@keyframes fadeInOut{0%{opacity:0;}10%{opacity:1;}80%{opacity:1;}100%{opacity:0;}}
</style>


@keyframes fadeInOut{0%{opacity:0;top:2rem;}10%{opacity:1;top:1rem;}80%{opacity:1;}100%{opacity:0;}}

/* â”€â”€ Countdown â”€â”€ */
#countdown{
  display:none;position:fixed;inset:0;
  background:#0a0a0a;z-index:200;
  align-items:center;justify-content:center;flex-direction:column;
}
.countdown-num{
  font-family:'Oswald',sans-serif;
  font-size:10rem;font-weight:700;color:#fff;
  animation:countPop 0.8s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes countPop{
  0%{transform:scale(2);opacity:0;}
  100%{transform:scale(1);opacity:1;}
}
.countdown-label{
  font-size:1rem;letter-spacing:0.4em;color:#555;
  text-transform:uppercase;margin-top:1rem;
}

/* â”€â”€ Answer animations â”€â”€ */
@keyframes correctBurst{
  0%{transform:scale(1);}
  30%{transform:scale(1.08);}
  100%{transform:scale(1);}
}
@keyframes wrongShake{
  0%,100%{transform:translateX(0);}
  20%{transform:translateX(-8px);}
  40%{transform:translateX(8px);}
  60%{transform:translateX(-6px);}
  80%{transform:translateX(6px);}
}
.ans-correct{animation:correctBurst 0.5s ease forwards !important;background:#22c55e !important;}
.ans-wrong{animation:wrongShake 0.5s ease forwards !important;background:#ef4444 !important;}

/* â”€â”€ Confetti â”€â”€ */
.confetti-piece{
  position:fixed;width:10px;height:10px;
  top:-10px;border-radius:2px;
  animation:confettiFall linear forwards;
  z-index:300;pointer-events:none;
}
@keyframes confettiFall{
  0%{transform:translateY(0) rotate(0deg);opacity:1;}
  100%{transform:translateY(110vh) rotate(720deg);opacity:0;}
}
</style>
</head>
<body>

<!-- Countdown -->
<div id="countdown">
  <div class="countdown-num" id="countNum">3</div>
  <div class="countdown-label">Ø§Ø³ØªØ¹Ø¯!</div>
</div>

<div class="topbar">
  <a href="/">â†</a>
  <div class="topbar-brand"><span>ALPHA</span> QUIZ</div>
</div>

<!-- Join -->
<div class="main" id="joinScreen">
  <div class="card">
    <div class="card-title">ğŸ® Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ <span>Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</span></div>
    <input type="text" id="codeInput" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù„Ø¹Ø¨Ø©" maxlength="6"
      oninput="this.value=this.value.replace(/\D/g,'')"
      onkeydown="if(event.key==='Enter')tryJoin()"/>
    <input type="text" id="nameInput" placeholder="Ø§Ø³Ù…Ùƒ" maxlength="20"
      onkeydown="if(event.key==='Enter')tryJoin()"/>
    <div id="teamSection" style="display:none;margin-bottom:1rem">
      <p style="font-size:0.75rem;letter-spacing:0.3em;color:#555;text-transform:uppercase;margin-bottom:0.6rem">Ø§Ø®ØªØ± ÙØ±ÙŠÙ‚Ùƒ</p>
      <div id="teamBtns" style="display:grid;grid-template-columns:1fr 1fr;gap:0.5rem"></div>
    </div>
    <button class="btn btn-join" onclick="tryJoin()">Ø¯Ø®ÙˆÙ„ â–¶</button>
  </div>
</div>

<!-- Waiting -->
<div class="main" id="waiting">
  <div>
    <div class="avatar">ğŸ®</div>
    <div class="player-name-big" id="myNameDisplay"></div>
    <div class="pulse-ring"></div>
    <div class="waiting-text">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©...</div>
  </div>
</div>

<!-- Question -->
<div id="question" style="display:none">
  <div class="q-header">
    <div class="q-counter-text" id="qCounterP">Ø³Ø¤Ø§Ù„ 1 / 1</div>
    <div class="timer-bar">
      <div class="timer-fill" id="timerFill" style="width:100%"></div>
    </div>
  </div>
  <img id="qImgP" style="display:none" class="q-image"/>
  <div class="q-text-player" id="qTextP">...</div>
  <div class="answer-btns" id="answerBtns"></div>
</div>

<!-- Answer Result Overlay -->
<div id="answerResult" style="display:none">
  <div class="result-icon" id="resultIcon">âœ…</div>
  <div class="result-text" id="resultText">Ø£Ø­Ø³Ù†Øª!</div>
  <div class="result-points" id="resultPoints">+750 Ù†Ù‚Ø·Ø©</div>
</div>

<!-- Leaderboard Update Overlay -->
<div id="lbUpdate" style="display:none;flex-direction:column;align-items:center">
  <div class="lb-title">// TOP PLAYERS</div>
  <div id="lbList"></div>
</div>

<!-- Final -->
<div id="playerFinal">
  <div class="final-rank-big" id="finalIcon">ğŸ‰</div>
  <div class="final-msg" id="finalMsg">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!</div>
  <div id="finalScore" style="color:#fff;font-size:1.5rem;font-weight:900;font-family:'Oswald',sans-serif;letter-spacing:0.1em"></div>
  <button class="btn btn-join" style="margin-top:2rem;max-width:300px;display:inline-block" onclick="location.href='/'">â–¶ Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
</div>

<script>
const socket = io();
const COLORS = ['#ccc','#1a1a1a','#444','#222'];
const SYMBOLS = ['â–²','â™¦','â—','â˜…'];
let myCode = null;
let myName = null;
let answered = false;
let selectedAnswer = -1;
let selectedTeam = '';

function selectTeam(t){
  selectedTeam = t;
  document.querySelectorAll('.team-btn').forEach(b => {
    b.style.background = 'transparent';
    b.style.borderColor = '#333';
    b.style.color = '#fff';
  });
  const btn = document.getElementById('team-' + t);
  btn.style.background = '#fff';
  btn.style.borderColor = '#fff';
  btn.style.color = '#111';
}
let maxTime = 20;
let timerInterval = null;

function tryJoin(){
  const code = document.getElementById('codeInput').value.trim();
  const name = document.getElementById('nameInput').value.trim();
  // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ ÙÙ‚Ø· Ø¥Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ø¸Ø§Ù‡Ø± (ÙŠØ¹Ù†ÙŠ Ù…Ø§ Ø¬Ø§Ø¡ Ù…Ù† QR)
  const codeVisible = document.getElementById('codeInput').style.display !== 'none';
  if(codeVisible && (!code || code.length < 6)){toast('Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙƒÙˆÙ‘Ù† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…');return;}
  if(!code){toast('Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­ØŒ Ø§Ù…Ø³Ø­ QR Ù…Ø¬Ø¯Ø¯Ø§Ù‹');return;}
  if(!name){toast('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ');return;}
  const teamSection = document.getElementById('teamSection');
  if(teamSection.style.display !== 'none' && !selectedTeam){
    toast('Ø§Ø®ØªØ± ÙØ±ÙŠÙ‚Ùƒ Ø£ÙˆÙ„Ø§Ù‹!'); return;
  }
  myCode = code;
  myName = name;
  socket.emit('player:join', {code, name, team: selectedTeam || ''});
}

// Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„ÙˆØ¶Ø¹ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
window.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const code = params.get('code');
  const mode = params.get('mode');

  if(code){
    document.getElementById('codeInput').value = code;
    document.getElementById('codeInput').style.display = 'none';
    setTimeout(()=>document.getElementById('nameInput').focus(), 300);
  }

  // Ø£Ø¸Ù‡Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±ÙŠÙ‚ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙˆØ¶Ø¹ Ø§Ù„ÙØ±ÙŠÙ‚
  const teamSection = document.getElementById('teamSection');
  if(mode === 'team'){
    teamSection.style.display = 'block';
    // Ø¨Ù†Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙØ±Ù‚ Ù…Ù† Ø§Ù„Ù€ URL
    try {
      const teamsParam = params.get('teams');
      if(teamsParam){
        const teams = JSON.parse(decodeURIComponent(teamsParam));
        buildTeamButtons(teams);
      }
    } catch(e){}
  } else {
    teamSection.style.display = 'none';
  }
});

socket.on('player:joined', (data)=>{
  const {name} = data;
  document.getElementById('joinScreen').style.display = 'none';
  document.querySelector('.main#waiting').style.display = 'flex';
  document.getElementById('myNameDisplay').textContent = name;
  if(data.team) {
    const teamEl = document.createElement('div');
    teamEl.style.cssText = 'font-size:0.8rem;letter-spacing:0.2em;color:#888;margin-top:0.3rem;';
    teamEl.textContent = data.team === 'A' ? 'ğŸ”´ Ø§Ù„ÙØ±ÙŠÙ‚ A' : 'ğŸ”µ Ø§Ù„ÙØ±ÙŠÙ‚ B';
    document.getElementById('myNameDisplay').insertAdjacentElement('afterend', teamEl);
  }
});

socket.on('error', (msg)=>{toast(msg);});

socket.on('player:kicked', ()=>{
  alert('ØªÙ… Ø¥Ø®Ø±Ø§Ø¬Ùƒ Ù…Ù† Ø§Ù„ØºØ±ÙØ© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø¶ÙŠÙ');
  location.href = '/';
});

socket.on('player:renamed', ({newName})=>{
  myName = newName;
  document.getElementById('myNameDisplay').textContent = newName;
  toast('ØªÙ… ØªØºÙŠÙŠØ± Ø§Ø³Ù…Ùƒ Ø¥Ù„Ù‰: ' + newName);
});

socket.on('game:question', ({index,total,question,answers,time,image})=>{
  answered = false;
  maxTime = time;
  hideAll();

  // Ø§Ø¹Ø¯Ø§Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³Ø¤Ø§Ù„
  document.getElementById('qCounterP').textContent = `Ø³Ø¤Ø§Ù„ ${index+1} / ${total}`;
  document.getElementById('qTextP').textContent = question;
  const img = document.getElementById('qImgP');
  if(image){img.src=image;img.style.display='block';}else{img.style.display='none';}
  const btns = document.getElementById('answerBtns');
  btns.innerHTML = answers.map((a,i)=>`
    <button class="ans-btn" style="background:${COLORS[i]}" onclick="sendAnswer(${i})">
      <span>${SYMBOLS[i]}</span><span>${a}</span>
    </button>
  `).join('');

  // Ø¹Ø¯Ø§Ø¯ ØªÙ†Ø§Ø²Ù„ÙŠ 3-2-1
  const cd = document.getElementById('countdown');
  const cdNum = document.getElementById('countNum');
  cd.style.display = 'flex';
  let count = 3;
  cdNum.textContent = count;
  const cdInterval = setInterval(()=>{
    count--;
    if(count <= 0){
      clearInterval(cdInterval);
      cd.style.display = 'none';
      document.getElementById('question').style.display = 'block';
      // Ø´Ø±ÙŠØ· Ø§Ù„ÙˆÙ‚Øª
      clearInterval(timerInterval);
      let t = time;
      const fill = document.getElementById('timerFill');
      fill.style.transition = 'none';
      fill.style.width = '100%';
      setTimeout(()=>{
        fill.style.transition = `width ${time}s linear`;
        fill.style.width = '0%';
      },50);
      timerInterval = setInterval(()=>{t--;if(t<=0)clearInterval(timerInterval);},1000);
    } else {
      cdNum.textContent = count;
      cdNum.style.animation = 'none';
      void cdNum.offsetWidth;
      cdNum.style.animation = 'countPop 0.8s cubic-bezier(0.34,1.56,0.64,1)';
    }
  }, 900);
  document.getElementById('qCounterP').textContent = `Ø³Ø¤Ø§Ù„ ${index+1} / ${total}`;
  document.getElementById('qTextP').textContent = question;

  const img = document.getElementById('qImgP');
  if(image){img.src=image;img.style.display='block';}else{img.style.display='none';}

  const btns = document.getElementById('answerBtns');
  btns.innerHTML = answers.map((a,i)=>`
    <button class="ans-btn" style="background:${COLORS[i]}"
      onclick="sendAnswer(${i})">
      <span>${SYMBOLS[i]}</span>
      <span>${a}</span>
    </button>
  `).join('');

});

function sendAnswer(i){
  if(answered) return;
  answered = true;
  selectedAnswer = i;
  // ÙÙ‚Ø· ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¯ÙˆÙ† Ø£Ù†ÙŠÙ…ÙŠØ´Ù† â€” Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† ÙŠØ¬ÙŠ Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
  document.querySelectorAll('.ans-btn').forEach((b,idx)=>{
    if(idx === i){
      b.style.opacity = '1';
      b.style.border = '3px solid #fff';
    } else {
      b.style.opacity = '0.35';
    }
    b.onclick = null;
  });
  const timeLeft = parseFloat(document.getElementById('timerFill').style.width) / 100 * maxTime;
  socket.emit('player:answer', {code:myCode, answerIndex:i, timeLeft});
}

socket.on('player:answerResult', ({correct,points})=>{
  // Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø§Ù„Ù„ÙŠ Ø§Ø®ØªØ§Ø±Ù‡ Ø§Ù„Ù„Ø§Ø¹Ø¨
  document.querySelectorAll('.ans-btn').forEach((b,idx)=>{
    if(idx === selectedAnswer){
      b.classList.add(correct ? 'ans-correct' : 'ans-wrong');
    } else {
      b.style.opacity = '0.2';
    }
    b.onclick = null;
  });

  // Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† ÙŠØ·Ù„Ø¹ overlay Ø§Ù„Ù†ØªÙŠØ¬Ø©
  setTimeout(()=>{
    const el = document.getElementById('answerResult');
    el.style.display = 'flex';
    document.getElementById('resultIcon').textContent = correct ? 'âœ…' : 'âŒ';
    document.getElementById('resultText').textContent = correct ? 'Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! ğŸ‰' : 'Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© ğŸ˜”';
    document.getElementById('resultPoints').textContent = correct ? `+${points.toLocaleString()} Ù†Ù‚Ø·Ø©` : '0 Ù†Ù‚Ø·Ø©';
    if(correct) launchConfetti();
  }, 800);
});

function launchConfetti(){
  const colors = ['#fff','#aaa','#555','#ccc','#e5e5e5'];
  for(let i=0;i<60;i++){
    const el = document.createElement('div');
    el.className = 'confetti-piece';
    el.style.left = Math.random()*100 + 'vw';
    el.style.background = colors[Math.floor(Math.random()*colors.length)];
    el.style.width = (6+Math.random()*8) + 'px';
    el.style.height = (6+Math.random()*8) + 'px';
    el.style.animationDuration = (1.5+Math.random()*2) + 's';
    el.style.animationDelay = (Math.random()*0.5) + 's';
    document.body.appendChild(el);
    setTimeout(()=>el.remove(), 3500);
  }
}

socket.on('game:results', ({leaderboard})=>{
  document.getElementById('answerResult').style.display = 'none';
  document.getElementById('question').style.display = 'none';
  const el = document.getElementById('lbUpdate');
  el.style.display = 'flex';
  const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  document.getElementById('lbList').innerHTML = leaderboard.map((p,i)=>`
    <div class="lb-row">
      <span class="lb-rank">${medals[i]||'#'+(i+1)}</span>
      <span class="lb-name">${p.name}</span>
      <span class="lb-score">${p.score.toLocaleString()}</span>
    </div>
  `).join('');
});

socket.on('game:end', ({final})=>{
  hideAll();
  document.getElementById('playerFinal').style.display = 'block';
  const me = final.find(p=>p.name===myName);
  if(me){
    const icons = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
    document.getElementById('finalIcon').textContent = icons[me.rank-1] || 'ğŸ®';
    document.getElementById('finalMsg').textContent = `Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±ÙƒØ² #${me.rank}`;
    document.getElementById('finalScore').textContent = `${me.score.toLocaleString()} Ù†Ù‚Ø·Ø©`;
  }
});

function hideAll(){
  ['joinScreen','waiting','question','answerResult','lbUpdate'].forEach(id=>{
    const el = document.getElementById(id);
    if(el){el.style.display='none';}
  });
  document.querySelector('.main#waiting') && (document.querySelector('.main#waiting').style.display='none');
}

function toast(msg){
  const el = document.createElement('div');
  el.className = 'toast';
  el.textContent = msg;
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),3100);
}
</script>
</body>
</html>
