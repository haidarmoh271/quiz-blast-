<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ALPHA Quiz â€” Ø¬Ù‡Ø§Ø² Ø§Ù„ØªØ­ÙƒÙ…</title>
<script src="/socket.io/socket.io.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&family=Oswald:wght@700&display=swap');
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Tajawal',sans-serif;min-height:100vh;background:#111;color:#fff;display:flex;flex-direction:column;overflow-x:hidden;}

/* ØªØ£Ø«ÙŠØ± Ø®Ø· Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø¶ÙˆØ¦ÙŠ */
body::after{content:'';position:fixed;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,#fff,transparent);animation:scan 4s linear infinite;pointer-events:none;z-index:999;}
@keyframes scan{0%{top:-2px;}100%{top:100vh;}}

.topbar{background:#1a1a1a;border-bottom:1px solid #222;padding:0.8rem 1.5rem;display:flex;align-items:center;gap:1rem;position:relative;}
.topbar-brand{font-family:'Oswald',sans-serif;font-size:1.1rem;letter-spacing:0.2em;color:#fff;}

.main{flex:1;display:flex;align-items:center;justify-content:center;padding:1.5rem;}
.card{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:4px;padding:2rem;width:100%;max-width:400px;text-align:center;position:relative;}
.card::before{content:'';position:absolute;top:0;right:0;width:3px;height:100%;background:#fff;}

input{width:100%;padding:1rem;border-radius:2px;border:1px solid #333;background:#111;color:#fff;font-size:1.2rem;margin-bottom:1rem;text-align:center;outline:none;}
input:focus{border-color:#fff;}

.btn{width:100%;padding:1rem;border:none;border-radius:2px;font-size:1rem;font-weight:700;cursor:pointer;transition:0.15s;}
.btn-join{background:#fff;color:#111;}

/* Waiting Screen */
#waiting{display:none;flex-direction:column;align-items:center;justify-content:center;}
.avatar{font-size:3.5rem;margin-bottom:1rem;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.1);}}

/* Question Screen - Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
#question{display:none;height:100vh;flex-direction:column;}
.q-header{background:#1a1a1a;padding:1rem;text-align:center;border-bottom:1px solid #222;}
.timer-bar{height:6px;background:#222;margin-top:10px;border-radius:3px;overflow:hidden;}
.timer-fill{height:100%;background:#fff;width:100%;transition:width 1s linear;}

.answer-btns{flex:1;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;gap:10px;padding:10px;background:#000;}
.ans-btn{border:none;border-radius:8px;font-family:'Oswald',sans-serif;font-size:4rem;font-weight:900;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform 0.1s;}
.ans-btn:active{transform:scale(0.95);filter:brightness(1.2);}

/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.btn-a{background:#ef4444;}
.btn-b{background:#3b82f6;}
.btn-c{background:#22c55e;}
.btn-d{background:#eab308;}

/* Result Screen */
#answerResult{display:none;position:fixed;inset:0;background:#111;z-index:100;flex-direction:column;align-items:center;justify-content:center;text-align:center;}
.result-icon{font-size:6rem;margin-bottom:1rem;}

/* Toast */
.toast{position:fixed;top:1rem;left:50%;transform:translateX(-50%);background:#fff;color:#111;padding:0.8rem 1.5rem;z-index:9999;animation:fadeInOut 3s forwards;}
@keyframes fadeInOut{0%{opacity:0;}10%{opacity:1;}80%{opacity:1;}100%{opacity:0;}}

#countdown{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:2000;align-items:center;justify-content:center;font-size:8rem;font-family:'Oswald';}
</style>
</head>
<body>

<div id="countdown">3</div>

<div id="joinScreen" class="main">
  <div class="card">
    <div class="topbar-brand" style="margin-bottom:1.5rem">ALPHA QUIZ</div>
    <input type="text" id="codeInput" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©" maxlength="6">
    <input type="text" id="nameInput" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±">
    <button class="btn btn-join" onclick="tryJoin()">Ø§Ù†Ø¶Ù… Ø§Ù„Ø¢Ù†</button>
  </div>
</div>

<div id="waiting" class="main">
  <div class="avatar">ğŸš€</div>
  <h2 id="myNameDisplay"></h2>
  <p style="color:#888; margin-top:10px;">Ø£Ù†Øª Ù…ØªØµÙ„! Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…Ø¶ÙŠÙ Ù„ÙŠØ¨Ø¯Ø£...</p>
</div>

<div id="question">
  <div class="q-header">
    <div id="qCounter">Ø³Ø¤Ø§Ù„ 1</div>
    <div class="timer-bar"><div id="timerFill" class="timer-fill"></div></div>
  </div>
  <div class="answer-btns" id="btnContainer">
    </div>
</div>

<div id="answerResult">
  <div id="resIcon" class="result-icon"></div>
  <h1 id="resText"></h1>
  <p id="resPoints" style="font-size:1.5rem; margin-top:10px;"></p>
</div>

<script>
const socket = io();
let myCode, myName, selectedLetter = null, answered = false;
let maxTime = 20;

function tryJoin() {
  myCode = document.getElementById('codeInput').value.trim();
  myName = document.getElementById('nameInput').value.trim();
  if(!myCode || !myName) return toast("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
  socket.emit('player:join', {code: myCode, name: myName});
}

socket.on('player:joined', (data) => {
  document.getElementById('joinScreen').style.display = 'none';
  document.getElementById('waiting').style.display = 'flex';
  document.getElementById('myNameDisplay').textContent = data.name;
});

socket.on('game:question', (data) => {
  answered = false;
  selectedLetter = null;
  maxTime = data.time;
  
  // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ø£Ø­Ø±Ù ÙÙ‚Ø·)
  const container = document.getElementById('btnContainer');
  container.innerHTML = '';
  const letters = data.letters || ['A','B','C','D'];
  const colors = ['btn-a', 'btn-b', 'btn-c', 'btn-d'];

  letters.forEach((l, i) => {
    const b = document.createElement('button');
    b.className = `ans-btn ${colors[i]}`;
    b.textContent = l;
    b.onclick = () => sendAnswer(l, b);
    container.appendChild(b);
  });

  document.getElementById('qCounter').textContent = `Ø³Ø¤Ø§Ù„ ${data.index + 1}`;
  
  // Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø§Ù„Ø¨Ø³ÙŠØ·
  const cd = document.getElementById('countdown');
  cd.style.display = 'flex';
  let c = 3; cd.textContent = c;
  const inv = setInterval(() => {
    c--;
    if(c<=0) {
      clearInterval(inv); cd.style.display = 'none';
      document.getElementById('waiting').style.display = 'none';
      document.getElementById('answerResult').style.display = 'none';
      document.getElementById('question').style.display = 'flex';
      startTimer(data.time);
    } else { cd.textContent = c; }
  }, 1000);
});

function startTimer(t) {
  const fill = document.getElementById('timerFill');
  fill.style.transition = 'none'; fill.style.width = '100%';
  setTimeout(() => {
    fill.style.transition = `width ${t}s linear`;
    fill.style.width = '0%';
  }, 50);
}

function sendAnswer(letter, btn) {
  if(answered) return;
  answered = true;
  selectedLetter = letter;
  
  // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
  document.querySelectorAll('.ans-btn').forEach(b => b.style.opacity = '0.2');
  btn.style.opacity = '1';
  btn.style.border = '8px solid white';

  const pct = parseFloat(document.getElementById('timerFill').style.width) || 0;
  const timeLeft = (pct/100) * maxTime;
  socket.emit('player:answer', {code: myCode, letter: letter, timeLeft});
}

socket.on('player:answerResult', (data) => {
  // Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
  window.lastResult = data;
});

socket.on('game:revealAnswer', (data) => {
  const res = window.lastResult;
  document.getElementById('question').style.display = 'none';
  document.getElementById('answerResult').style.display = 'flex';
  
  if(res) {
    document.getElementById('resIcon').textContent = res.correct ? 'âœ…' : 'âŒ';
    document.getElementById('resText').textContent = res.correct ? 'ØµØ­!' : 'Ø®Ø·Ø£!';
    document.getElementById('resPoints').textContent = `+${res.points} Ù†Ù‚Ø·Ø©`;
    document.body.style.background = res.correct ? '#1a3a1a' : '#3a1a1a';
  }
});

socket.on('error', (m) => toast(m));
function toast(m) {
  const t = document.createElement('div'); t.className = 'toast'; t.textContent = m;
  document.body.appendChild(t); setTimeout(() => t.remove(), 3000);
}
</script>
</body>
</html>
