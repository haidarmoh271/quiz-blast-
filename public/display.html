<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ALPHA â€” Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“º</text></svg>"/>
<script src="/socket.io/socket.io.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&family=Oswald:wght@700&display=swap" rel="stylesheet"/>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
:root{
  --red:#e21b3c; --blue:#1368ce; --yellow:#d89e00; --green:#26890c;
}
html,body{
  width:100%;height:100%;overflow:hidden;
  font-family:'Tajawal',sans-serif;
  background:#0a0a0a;color:#fff;
}

/* â•â•â• JOIN SCREEN â•â•â• */
#joinScreen{
  display:flex;align-items:center;justify-content:center;
  height:100vh;flex-direction:column;gap:1.5rem;
}
.brand{
  font-family:'Oswald',sans-serif;
  font-size:4rem;letter-spacing:0.2em;
  background:linear-gradient(135deg,#fff 0%,#888 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.join-card{
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.12);
  border-radius:16px;padding:2.5rem;
  width:90%;max-width:440px;text-align:center;
}
.join-card h2{font-size:1.1rem;letter-spacing:0.2em;margin-bottom:0.4rem;}
.join-card p{font-size:0.8rem;color:#555;margin-bottom:1.8rem;}
.code-input{
  width:100%;padding:1.2rem;
  font-size:2rem;font-family:'Oswald',sans-serif;
  letter-spacing:0.5em;text-align:center;
  background:rgba(255,255,255,0.06);
  border:2px solid rgba(255,255,255,0.15);
  border-radius:10px;color:#fff;outline:none;
  text-transform:uppercase;
}
.code-input:focus{border-color:rgba(255,255,255,0.4);}
.btn-join{
  width:100%;margin-top:1rem;padding:1rem;
  background:#fff;color:#111;
  border:none;border-radius:10px;
  font-family:'Tajawal',sans-serif;font-size:1.1rem;font-weight:900;
  cursor:pointer;letter-spacing:0.1em;
  transition:transform 0.15s,background 0.15s;
}
.btn-join:hover{background:#e5e5e5;transform:translateY(-2px);}
.err-msg{color:#ef4444;font-size:0.85rem;margin-top:0.5rem;display:none;}

/* â•â•â• LOBBY â•â•â• */
#lobbyScreen{
  display:none;align-items:center;justify-content:center;
  height:100vh;flex-direction:column;gap:2rem;
  background:radial-gradient(ellipse at center,#111 0%,#000 100%);
}
.lobby-title{font-family:'Oswald',sans-serif;font-size:2.5rem;letter-spacing:0.3em;color:#888;}
.lobby-code-big{
  font-family:'Oswald',sans-serif;
  font-size:9rem;font-weight:700;letter-spacing:0.3em;
  color:#fff;line-height:1;
  text-shadow:0 0 60px rgba(255,255,255,0.15);
  animation:pulse-glow 3s ease-in-out infinite;
}
@keyframes pulse-glow{
  0%,100%{text-shadow:0 0 40px rgba(255,255,255,0.1);}
  50%{text-shadow:0 0 80px rgba(255,255,255,0.25);}
}
.lobby-hint{font-size:1.1rem;color:#444;letter-spacing:0.3em;text-transform:uppercase;}
.quiz-title-display{
  font-size:1.8rem;font-weight:700;color:#fff;
  background:rgba(255,255,255,0.07);
  border:1px solid rgba(255,255,255,0.12);
  border-radius:12px;padding:1rem 2.5rem;
}

/* â•â•â• COUNTDOWN 3-2-1 â•â•â• */
#countdownScreen{
  display:none;align-items:center;justify-content:center;
  height:100vh;
}
.countdown-num{
  font-family:'Oswald',sans-serif;
  font-size:18rem;font-weight:700;color:#fff;
  animation:countAnim 0.9s ease-in-out;
}
@keyframes countAnim{
  0%{transform:scale(1.4);opacity:0;}
  40%{transform:scale(1);opacity:1;}
  80%{transform:scale(1);opacity:1;}
  100%{transform:scale(0.6);opacity:0;}
}

/* â•â•â• QUESTION SCREEN â•â•â• */
#questionScreen{
  display:none;
  height:100vh;
  flex-direction:column;
}
.q-topbar{
  display:flex;align-items:center;justify-content:space-between;
  padding:1.2rem 2.5rem;
  background:rgba(0,0,0,0.4);
  border-bottom:1px solid rgba(255,255,255,0.07);
  flex-shrink:0;
}
.q-counter{
  font-family:'Oswald',sans-serif;
  font-size:1.2rem;color:#666;letter-spacing:0.2em;
}
.timer-display{
  width:80px;height:80px;
  border-radius:50%;
  border:5px solid rgba(255,255,255,0.15);
  display:flex;align-items:center;justify-content:center;
  font-family:'Oswald',sans-serif;font-size:2rem;font-weight:700;
  transition:border-color 0.5s, color 0.5s;
  position:relative;
}
.timer-display.urgent{border-color:#e21b3c;color:#e21b3c;}
.q-body{
  flex:1;display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  padding:2rem 4rem;
  gap:2.5rem;
}
.q-image-display{
  max-height:25vh;max-width:80%;
  object-fit:contain;border-radius:12px;
  display:none;
}
.q-text-display{
  font-size:2.8rem;font-weight:900;
  text-align:center;line-height:1.3;
  max-width:900px;
  text-shadow:0 2px 20px rgba(0,0,0,0.5);
}
.answers-grid-display{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
  width:100%;max-width:1000px;
}
.ans-display{
  display:flex;align-items:center;gap:16px;
  padding:1.2rem 1.8rem;
  border-radius:14px;
  border:3px solid transparent;
  font-size:1.5rem;font-weight:700;
  transition:transform 0.2s;
}
.ans-display .icon{
  width:52px;height:52px;min-width:52px;
  border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  font-size:1.6rem;
}

/* â•â•â• RESULTS SCREEN â•â•â• */
#resultsScreen{
  display:none;
  height:100vh;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:2rem 3rem;
  gap:1.5rem;
}
.results-title{
  font-family:'Oswald',sans-serif;
  font-size:2rem;letter-spacing:0.3em;color:#888;
}
.results-answers{
  display:grid;grid-template-columns:1fr 1fr;
  gap:14px;width:100%;max-width:1000px;
}
.res-card{
  display:flex;align-items:center;gap:14px;
  padding:1.2rem 1.6rem;
  border-radius:14px;
  border:3px solid transparent;
  font-size:1.4rem;font-weight:700;
  transition:all 0.4s;
}
.res-card .icon{
  width:52px;height:52px;min-width:52px;
  border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  font-size:1.4rem;
}
.res-info{flex:1;}
.res-text{font-weight:700;line-height:1.2;}
.res-votes{font-size:0.9rem;color:rgba(255,255,255,0.5);margin-top:0.2rem;}
.res-pct{
  font-family:'Oswald',sans-serif;
  font-size:1.6rem;font-weight:700;
}

/* â•â•â• LEADERBOARD â•â•â• */
#lbScreen{
  display:none;height:100vh;
  flex-direction:column;align-items:center;
  justify-content:center;padding:2rem 4rem;gap:1rem;
}
.lb-title-big{
  font-family:'Oswald',sans-serif;
  font-size:2.5rem;letter-spacing:0.3em;margin-bottom:0.5rem;
}
.lb-row-big{
  display:flex;align-items:center;gap:1.2rem;
  width:100%;max-width:900px;
  padding:1.2rem 2rem;
  border-radius:14px;
  animation:slideIn 0.5s ease both;
  font-size:1.4rem;
}
@keyframes slideIn{from{transform:translateX(60px);opacity:0;}to{transform:none;opacity:1;}}
.lb-medal{font-size:2.2rem;width:52px;text-align:center;}
.lb-name-big{flex:1;font-weight:700;}
.lb-score-big{font-family:'Oswald',sans-serif;font-size:2rem;font-weight:700;}

/* â•â•â• FINAL â•â•â• */
#finalScreen{
  display:none;height:100vh;
  flex-direction:column;align-items:center;
  justify-content:center;gap:1.5rem;
  background:radial-gradient(ellipse at top,#1a1200 0%,#0a0a0a 60%);
}
.final-title{font-family:'Oswald',sans-serif;font-size:3rem;letter-spacing:0.3em;}
.podium-display{
  display:flex;align-items:flex-end;justify-content:center;gap:1rem;
  margin:1rem 0;
}
.pod-display{
  display:flex;flex-direction:column;align-items:center;justify-content:flex-end;
  gap:0.5rem;padding:1.5rem 1rem;border-radius:14px;
  border:1px solid rgba(255,255,255,0.1);
}

/* animations */
@keyframes barUp{from{transform:scaleY(0);opacity:0;}to{transform:none;opacity:1;}}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:none;}}
</style>
</head>
<body>

<!-- Join -->
<div id="joinScreen">
  <div class="brand">ALPHA</div>
  <div class="join-card">
    <h2>ğŸ“º Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶</h2>
    <p>Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‡Ø§</p>
    <input class="code-input" id="codeInput" maxlength="6" placeholder="XXXX"
      onkeydown="if(event.key==='Enter')joinDisplay()"
      oninput="this.value=this.value.toUpperCase()"/>
    <div class="err-msg" id="errMsg">Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© âŒ</div>
    <button class="btn-join" onclick="joinDisplay()">Ø§ØªØµØ§Ù„ ğŸ“º</button>
  </div>
</div>

<!-- Lobby -->
<div id="lobbyScreen">
  <div class="lobby-title">Ø§Ù†Ø¶Ù… Ø¨Ø§Ù„ÙƒÙˆØ¯</div>
  <div class="lobby-code-big" id="lobbyCodeBig">----</div>
  <div class="quiz-title-display" id="quizTitleDisplay"></div>
  <div class="lobby-hint">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©...</div>
</div>

<!-- Countdown -->
<div id="countdownScreen">
  <div class="countdown-num" id="cdNum">3</div>
</div>

<!-- Question -->
<div id="questionScreen">
  <div class="q-topbar">
    <div class="q-counter" id="qCounterD">Ø³Ø¤Ø§Ù„ 1/1</div>
    <div class="timer-display" id="timerD">20</div>
  </div>
  <div class="q-body">
    <img id="qImgD" class="q-image-display"/>
    <div class="q-text-display" id="qTextD"></div>
    <div class="answers-grid-display" id="answersGridD"></div>
  </div>
</div>

<!-- Results -->
<div id="resultsScreen">
  <div class="results-title">ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø³Ø¤Ø§Ù„</div>
  <div class="results-answers" id="resultsAnswersD"></div>
</div>

<!-- Leaderboard -->
<div id="lbScreen">
  <div class="lb-title-big">ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†</div>
  <div id="lbRowsD" style="width:100%;max-width:900px;display:flex;flex-direction:column;gap:0.8rem"></div>
</div>

<!-- Final -->
<div id="finalScreen">
  <div class="final-title">ğŸ† Ø§Ù„Ù†Ù‡Ø§ÙŠØ©!</div>
  <div class="podium-display" id="podiumD"></div>
  <div id="finalListD" style="display:flex;flex-direction:column;gap:0.6rem;width:100%;max-width:700px"></div>
</div>

<script>
const socket = io();
const COLORS = ['#e21b3c','#1368ce','#d89e00','#26890c'];
const SHAPES = ['â–²','â—†','â—','âœ¦'];
const MEDALS = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
let myCode = '';
let timerInterval = null;

function show(id){
  ['joinScreen','lobbyScreen','countdownScreen','questionScreen','resultsScreen','lbScreen','finalScreen']
    .forEach(s=>{
      const el = document.getElementById(s);
      el.style.display = 'none';
    });
  const target = document.getElementById(id);
  target.style.display = 'flex';
}

function joinDisplay(){
  const code = document.getElementById('codeInput').value.trim().toUpperCase();
  if(!code){return;}
  myCode = code;
  socket.emit('display:join', {code});
}

socket.on('display:error', (msg)=>{
  const err = document.getElementById('errMsg');
  err.textContent = msg + ' âŒ';
  err.style.display = 'block';
});

socket.on('display:joined', ({code, title})=>{
  document.getElementById('lobbyCodeBig').textContent = code;
  document.getElementById('quizTitleDisplay').textContent = title || '';
  show('lobbyScreen');
});

socket.on('display:question', ({index, total, question, answers, time, image})=>{
  clearInterval(timerInterval);

  // 3-2-1 countdown
  show('countdownScreen');
  let cd = 3;
  const cdEl = document.getElementById('cdNum');
  cdEl.textContent = cd;
  const cdInt = setInterval(()=>{
    cd--;
    if(cd <= 0){
      clearInterval(cdInt);
      showQuestion(index, total, question, answers, time, image);
    } else {
      cdEl.style.animation = 'none';
      cdEl.offsetHeight; // reflow
      cdEl.style.animation = 'countAnim 0.9s ease-in-out';
      cdEl.textContent = cd;
    }
  }, 900);
});

function showQuestion(index, total, question, answers, time, image){
  document.getElementById('qCounterD').textContent = `Ø³Ø¤Ø§Ù„ ${index+1} / ${total}`;
  document.getElementById('qTextD').textContent = question;

  const img = document.getElementById('qImgD');
  if(image){ img.src = image; img.style.display = 'block'; }
  else { img.style.display = 'none'; }

  // Ø±Ø³Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
  const grid = document.getElementById('answersGridD');
  grid.innerHTML = answers.map((a,i)=>`
    <div class="ans-display" style="background:${COLORS[i]}22;border-color:${COLORS[i]}66;">
      <div class="icon" style="background:${COLORS[i]}">${SHAPES[i]}</div>
      <span>${a}</span>
    </div>
  `).join('');

  show('questionScreen');

  // ØªØ§ÙŠÙ…Ø±
  let t = time;
  const timerEl = document.getElementById('timerD');
  timerEl.textContent = t;
  timerEl.className = 'timer-display';
  timerInterval = setInterval(()=>{
    t--;
    timerEl.textContent = t;
    if(t <= 5) timerEl.className = 'timer-display urgent';
    if(t <= 0){ clearInterval(timerInterval); }
  }, 1000);
}

socket.on('display:results', ({correct, stats, leaderboard, answers, isLast})=>{
  clearInterval(timerInterval);
  const total = stats.reduce((a,s)=>a+s.count,0)||1;

  // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ ØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµØ­ÙŠØ­
  const container = document.getElementById('resultsAnswersD');
  container.innerHTML = answers.map((a,i)=>{
    const s = stats[i];
    const pct = Math.round((s.count/total)*100);
    const isCorrect = i === correct;
    return `
      <div class="res-card" style="
        background:${isCorrect ? COLORS[i]+'33' : COLORS[i]+'15'};
        border-color:${isCorrect ? COLORS[i] : COLORS[i]+'44'};
        ${isCorrect ? 'box-shadow:0 0 30px '+COLORS[i]+'44' : ''};
        animation:fadeIn 0.4s ease ${i*0.1}s both;
      ">
        <div class="icon" style="background:${COLORS[i]};${isCorrect?'box-shadow:0 0 16px '+COLORS[i]+'88':''}">
          ${isCorrect ? 'âœ“' : SHAPES[i]}
        </div>
        <div class="res-info">
          <div class="res-text">${a}</div>
          <div class="res-votes">${s.count} ØµÙˆØª</div>
        </div>
        <div class="res-pct" style="color:${isCorrect?'#22c55e':'#555'}">${pct}%</div>
      </div>
    `;
  }).join('');

  show('resultsScreen');

  // Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ: Ø§Ù„Ø³ÙƒÙˆØ±Ø¨ÙˆØ±Ø¯
  setTimeout(()=>{
    const medals = MEDALS;
    const lbEl = document.getElementById('lbRowsD');
    lbEl.innerHTML = leaderboard.slice(0,5).map((p,i)=>`
      <div class="lb-row-big" style="
        background:${i===0?'rgba(255,215,0,0.12)':i===1?'rgba(192,192,192,0.08)':i===2?'rgba(205,127,50,0.08)':'rgba(255,255,255,0.05)'};
        border:1px solid ${i===0?'rgba(255,215,0,0.3)':'rgba(255,255,255,0.08)'};
        animation-delay:${i*0.12}s;
      ">
        <span class="lb-medal">${medals[i]||('#'+(i+1))}</span>
        <span class="lb-name-big">${p.name}</span>
        <span class="lb-score-big" style="color:${i===0?'#ffd700':i===1?'#c0c0c0':i===2?'#cd7f32':'#fff'}">${p.score.toLocaleString()}</span>
      </div>
    `).join('');
    show('lbScreen');
  }, 4000);
});

socket.on('display:end', ({final})=>{
  clearInterval(timerInterval);

  // Ù…Ù†ØµØ©
  const top3 = final.slice(0,3);
  const order = [1,0,2];
  const heights = ['140px','180px','110px'];
  const colors = ['rgba(192,192,192,0.15)','rgba(255,215,0,0.2)','rgba(205,127,50,0.15)'];
  document.getElementById('podiumD').innerHTML = order.map((rank,col)=>{
    const p = top3[rank];
    if(!p) return '';
    return `
      <div class="pod-display" style="height:${heights[col]};background:${colors[col]};width:160px;">
        <span style="font-size:2.5rem">${MEDALS[rank]||''}</span>
        <span style="font-size:1.2rem;font-weight:700;text-align:center">${p.name}</span>
        <span style="font-family:'Oswald',sans-serif;font-size:1.5rem;color:#ffd700">${p.score.toLocaleString()}</span>
      </div>
    `;
  }).join('');

  // Ù‚Ø§Ø¦Ù…Ø© ÙƒØ§Ù…Ù„Ø©
  document.getElementById('finalListD').innerHTML = final.map((p,i)=>`
    <div style="display:flex;align-items:center;gap:1rem;
      background:${i<3?'rgba(255,255,255,0.07)':'rgba(255,255,255,0.03)'};
      border-radius:10px;padding:0.9rem 1.5rem;">
      <span style="font-size:1.5rem;width:40px;text-align:center">${MEDALS[i]||('#'+(i+1))}</span>
      <span style="flex:1;font-size:1.2rem;font-weight:700">${p.name}</span>
      <span style="font-family:'Oswald',sans-serif;font-size:1.4rem;color:#ffd700">${p.score.toLocaleString()}</span>
    </div>
  `).join('');

  show('finalScreen');
});
</script>
</body>
</html>
